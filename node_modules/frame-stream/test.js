// 8087

var net = require('net')
var stream = require('stream')
var frame = require('./lib')
var socket = net.connect(8087, function() {
  var message = new Buffer(5)
  message.writeInt32BE(1, 0)
  message.writeInt8(1, 4)

  message = Buffer.concat([message, message])

  socket.pipe(through({}, function(chunk, enc, cont) {
    console.log(chunk)
    cont()
  }))

  socket.write(message)



  return

  var message = new Buffer(1)
  // message.writeInt32BE(1, 0)
  message.writeInt8(1, 0)

  var framer = new frame.FramerStream()

  framer.pipe(socket)
  .pipe(frame())
  .pipe(through({}, function(chunk, enc, cont) {
    console.log(chunk)
    cont()
  }))

  framer.write(message)
})

function through(opts, transform, flush) {
  var t = new stream.Transform(opts)

  t._transform = transform

  if (flush) {
    t._flush = flush
  }

  return t
}